## 4. Módulo de Utilidades (helpers.ts)

Este módulo constituye un repositorio de utilidades auxiliares para la resolución de problemas comunes de CSS mediante funciones puras de TypeScript.

### 4.1. Generadores de Color (Módulo de Color CSS Nivel 5)

La biblioteca adopta el estándar futuro de los colores en la web.

* **Colores Relativos (hslFrom, rgbFrom):** Permiten derivar un nuevo color modificando canales específicos de un color base (incluso si el base es una variable CSS).
  * *Mecánica:* Construye la sintaxis `hsl(from <color-base> <h> <s> <l> / <alpha>)`.
  * *Uso:* Creación de variantes hover, focus o paletas monocromáticas dinámicamente sin conocimiento del color original.

```typescript
    /** Ejemplo: Creación de un borde semitransparente basado en el color de fondo actual */
    const borderColor = hslFrom((c, u) => [
        c.var('bg-primary'), /** Base */
        c.h, c.s, c.l, /** Mantener canales */
        0.5 /** Alpha al 50% */
    ])
```

### 4.2. Tipografía Fluida y Diseño (lerpcss)

Resuelve la problemática de la tipografía responsiva sin saltos abruptos (puntos de interrupción).

* **Fórmula Matemática:** Utiliza la ecuación de la recta (`y = mx + b`) dentro de una función `clamp()` de CSS.
* **Cálculo:**
  1. Se calcula la pendiente (`m`) basada en los puertos de visualización mínimo y máximo (400px - 1100px por defecto).
  2. Se genera una expresión `calc()` que interpola el valor suavemente entre esos dos puntos.
  3. Se envuelve todo en `clamp(min, calc(...), max)` para asegurar límites seguros.

### 4.3. Constructor de Transformaciones

La generación manual de cadenas `transform` complejas es propensa a errores. Este constructor asegura el orden y las unidades.

* **Acumulador de Operaciones:** Cada llamada (`.translate`, `.rotate`) inserta una instrucción en una matriz interna.
* **Serialización:** El método `.str()` une la matriz con espacios, produciendo la cadena final válida para CSS.

## 5. Exemplares de Implementación Avanzada

### 5.1. Componente de Tarjeta Interactiva con Tema Dinámico

El presente ejemplo demuestra la creación de componentes, la gestión de eventos y los estilos anidados.

```typescript
    import { element, insertStyle, HELPERS } from './lib'

    /** 1. Definición de Estilos (CSS-in-JS) */
    const cardStyles = {
        '.card': {
            border: '1px solid #ddd',
            borderRadius: 8, /** Infiere px */
            padding: 16,
            boxShadow: HELPERS.boxShadow({dY: 4, blur: 10, color: 'rgba(0,0,0,0.1)'}),
            transition: 'transform 0.2s ease, box-shadow 0.2s ease',
            backgroundColor: 'white',
            /** Pseudo-clases anidadas */
            '&:hover': {
                transform: HELPERS.transform().translateY(-5).str(),
                boxShadow: HELPERS.boxShadow({dY: 8, blur: 20, color: 'rgba(0,0,0,0.15)'}),
                cursor: HELPERS.pointer
            }
        },
        '.card-title': {
            fontSize: HELPERS.lerp({min: 18, max: 24}), /** Tipografía fluida */
            color: '#333',
            marginBottom: 8
        }
    }

    /** Inyectar estilos una sola vez */
    insertStyle({id: 'card-component-styles', css: cardStyles})

    /** 2. Definición del Componente (Función Factoría) */
    interface CardProps {title: string, description: string, onAction: () => void}

    const Card = ({title, description, onAction}: CardProps) => {
        return element('article.card')
            /** Estructura interna */
            .appendChild(
                element('h3.card-title').text(title),
                element('p.card-desc').style({color: '#666', lineHeight: 1.5}).text(description),
                element('button.btn-primary{Ver Detalles}')
                    .style({marginTop: 10})
                    .click((e) => {
                        e.stopPropagation() /** Control granular del evento */
                        onAction()
                    })
            )
            /** Evento en el contenedor */
            .on({
                event: 'mouseenter',
                handler: () => console.log(`Hover sobre ${title}`),
                options: {passive: true}
            })
    }

    /** 3. Montaje en el DOM */
    const container = document.getElementById('app')
    if (container) {
        element(container).appendChild(
            Card({
                title: "Ingeniería de Software",
                description: "Arquitectura avanzada de sistemas UI.",
                onAction: () => alert("Abriendo detalles...")
            }).resume()
        )
    }
```

### 5.2. Utilización de Variables CSS para Tematización

```typescript
    import { toCSS, insertStyle } from './lib'

    /** Definir variables globales */
    const globalVars = {vars: {brandColor: '#ff5722', spacingUnit: '8px'}}

    /** Componente que consume las variables */
    const componentStyles = {
        '.themed-box': {
            /** Uso de helper cssVar para referencia segura */
            backgroundColor: HELPERS.cssVar('brand-color'),
            padding: HELPERS.calc(HELPERS.mult(HELPERS.cssVar('spacing-unit'), 2)) /** calc(var(--spacing-unit) * 2) */
        }
    }

    insertStyle({id: 'theme-root', css: globalVars})
    insertStyle({id: 'component-theme', css: componentStyles})
```

## 6. Referencia de Definición de Tipos (types.ts)

La solidez de la biblioteca reside en sus definiciones de tipos. La comprensión de las mismas resulta crucial para extender la funcionalidad.

### JSONElement (Estructura de Datos Recursiva)

Define la estructura para crear componentes declarativos puramente mediante datos.

```typescript
    interface JSONElement {
        [key: string]: any
        children?: (JSONElement | string)[] /** Propiedad especial reservada para anidamiento */
    }
```

### InsertStyleInput (Configuración Flexible)

Permite sobrecargas para simplificar la API de estilos.

```typescript
    type InsertStyleInput = 
        | string /** Caso simple: CSS crudo */
        | {
            style?: HTMLStyleElement /** Referencia directa para actualizaciones */
            id?: string /** Identificador para gestión de singleton */
            clases?: string | string[] /** Clases de metadatos para la etiqueta <style> */
            css?: string | object /** La carga útil real (objeto o cadena) */
            [selector: string]: any /** Firma de índice para reglas CSS adicionales */
        }
```

## 7. Léxico de Constantes Internas y Heurística

Ubicadas en `helpers.ts`, las presentes constantes dictaminan el comportamiento del motor de inferencia.

* **CSS_ATTRS_NUMBER (Lista de Exclusión):**
  * Propiedades que, de acuerdo con la especificación CSS, aceptan valores numéricos sin unidad (escalares o contadores).
  * *Incluye:* `z-index`, `scale`, `opacity`, `line-height`, `flex-grow`, `font-weight`.
  * *Comportamiento:* Si una propiedad se encuentra en la presente lista, `toCSS` retorna el número sin modificación. En caso contrario, concatena el sufijo `px`.
* **HTML_TAGS (Validación de Selectores):**
  * Lista exhaustiva de elementos HTML estándar (`div`, `span`, `input`, etc.).
  * *Uso:* `toCSS` emplea dicha lista para distinguir si una clave constituye un selector de etiqueta HTML (v.gr., `button`) o una clase CSS que requiere prefijo (si no comienza con `.`).


